<!DOCTYPE html>
<html lang="bg">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Smart Release Planner ‚Äî MVP (Upload + Full Plan + PDF)</title>
  <style>
    :root { color-scheme: dark; }
    body { margin:0; background:#0f172a; color:#e5e7eb; font-family:system-ui,-apple-system,Segoe UI,Roboto,sans-serif; }
    .container { max-width:1100px; margin:0 auto; padding:24px; }
    h1 { margin:0 0 16px; display:flex; align-items:center; gap:10px; font-size:28px; }
    .card { background:#0b1220; border:1px solid #334155; border-radius:16px; padding:18px; }
    .row { display:grid; grid-template-columns:1fr; gap:14px; }
    @media (min-width: 900px){ .row{ grid-template-columns:1fr 1fr; } }
    label { display:block; font-size:13px; color:#cbd5e1; margin-bottom:6px; }
    input, textarea, button { width:100%; box-sizing:border-box; border-radius:10px; }
    input, textarea { background:#0a0f1a; color:#e5e7eb; border:1px solid #334155; padding:10px 12px; }
    textarea { min-height:90px; resize:vertical; }
    button { background:#38bdf8; color:#0a0f1a; border:none; padding:10px 14px; font-weight:700; cursor:pointer; }
    button.secondary { background:#111827; color:#e5e7eb; border:1px solid #334155; }
    button:disabled { opacity:.6; cursor:not-allowed; }
    .grid { display:grid; grid-template-columns:1fr; gap:14px; }
    @media (min-width: 900px){ .grid{ grid-template-columns:1fr 1fr; } }
    .event { background:#0a0f1a; border:1px solid #334155; border-radius:14px; padding:12px; }
    .muted { color:#94a3b8; font-size:12px; }
    .title { font-weight:700; }
    .spacer { height:12px; }
    .hidden { display:none; }
    .tips { margin-top:6px; white-space:pre-wrap; line-height:1.35; }
    .actions { display:flex; gap:8px; align-items:end; flex-wrap:wrap; }
  </style>
</head>
<body>
  <div class="container">
    <h1>üéµ Smart Release Planner ‚Äî MVP</h1>

    <div class="card">
      <div class="row">
        <div>
          <label for="songFile">Upload a Song (MP3/WAV)</label>
          <input id="songFile" type="file" accept="audio/*" />
        </div>
        <div>
          <label for="genre">–ñ–∞–Ω—Ä</label>
          <input id="genre" placeholder="Pop / HipHop / EDM / Indie / RnB / Rock / Trap" />
        </div>
        <div>
          <label for="wstart">–ü–µ—Ä–∏–æ–¥: –û—Ç</label>
          <input type="date" id="wstart" />
        </div>
        <div>
          <label for="wend">–ü–µ—Ä–∏–æ–¥: –î–æ</label>
          <input type="date" id="wend" />
        </div>
        <div>
          <label for="followers">–ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª–∏ (–ø–æ –∏–∑–±–æ—Ä)</label>
          <input id="followers" type="number" placeholder="–Ω–∞–ø—Ä. 2500" />
        </div>
        <div>
          <label for="notes">–ó–∞–±–µ–ª–µ–∂–∫–∏ (–ø–æ –∏–∑–±–æ—Ä)</label>
          <textarea id="notes" placeholder="–ö–æ–Ω—Ç–µ–∫—Å—Ç: –ø–ª–∞–Ω–∏—Ä–∞–Ω —Å–∏–Ω–≥—ä–ª, –∫–æ–ª–∞–±–æ—Ä–∞—Ü–∏—è, mood, BPM..."></textarea>
        </div>
        <div style="grid-column:1 / -1">
          <button id="genBtn">–ì–µ–Ω–µ—Ä–∏—Ä–∞–π –ø–ª–∞–Ω</button>
        </div>
      </div>
    </div>

    <div class="spacer"></div>

    <div id="resultWrap" class="hidden">
      <div class="card">
        <div class="title">üìÖ –ü—Ä–µ–ø–æ—Ä—ä—á–∞–Ω–∞ –¥–∞—Ç–∞ –∑–∞ —Ä–µ–ª–∏–π–∑</div>
        <div id="recDate" style="margin-top:6px; font-size:18px; font-weight:700">‚Äî</div>
        <div id="reason" class="muted">‚Äî</div>
        <div id="windowInfo" class="muted" style="margin-top:6px">‚Äî</div>
        <div class="row" style="margin-top:14px">
          <div>
            <div class="title" style="margin-bottom:6px">–ù–∞–π-–¥–æ–±—Ä–∏ –¥–Ω–∏ –∑–∞ –ø–æ—Å—Ç–≤–∞–Ω–µ</div>
            <ul id="bestDays"></ul>
          </div>
          <div class="actions">
            <button class="secondary" id="csvBtn">–ï–∫—Å–ø–æ—Ä—Ç CSV</button>
            <button class="secondary" id="icsBtn">–ï–∫—Å–ø–æ—Ä—Ç ICS</button>
            <button class="secondary" id="pdfBtn">–ï–∫—Å–ø–æ—Ä—Ç PDF</button>
          </div>
        </div>
      </div>

      <div class="spacer"></div>
      <div id="eventsGrid" class="grid"></div>
    </div>

    <p class="muted" style="margin-top:10px">MVP –¥–µ–º–æ: –ª–æ–∫–∞–ª–Ω–∞ –µ–≤—Ä–∏—Å—Ç–∏–∫–∞ –±–µ–∑ –≤—ä–Ω—à–Ω–∏ API. –ó–∞ —Ñ–∏–Ω–∞–ª –≤–∫–ª—é—á–∏ OpenAI + Spotify API –ø—Ä–µ–∑ Make/Bubble.</p>
  </div>

  <script>
    // ===== Utilities =====
    const sofiaTZ = "Europe/Sofia";
    const fmtBG = (dt)=> new Intl.DateTimeFormat("bg-BG", {dateStyle:"full", timeStyle:"short", timeZone:sofiaTZ}).format(dt);
    const addDays = (d, n)=>{ const x=new Date(d); x.setDate(x.getDate()+n); return x; };
    const atTime = (d, h=18, m=0)=>{ const x=new Date(d); x.setHours(h,m,0,0); return x; };

    function scoreDays(genre, followers){
      const base={1:.6,2:.8,3:.7,4:.95,5:.85,6:.4,0:.5};
      const boost={ pop:{2:.1,4:.15}, hiphop:{5:.15,6:-.1}, indie:{1:.05,2:.1,4:.1}, edm:{5:.15,6:.05}, rnb:{2:.08,4:.12}, rock:{4:.1,5:.08}, trap:{5:.12} };
      const g=(genre||"").toLowerCase(); const b=boost[g]||{}; const size = (parseInt(followers||0,10)>10000)? .05 : (parseInt(followers||0,10)>2000)? .02 : 0;
      const out={}; Object.entries(base).forEach(([k,v])=> out[k]=v+(b[k]||0)+size); return out;
    }
    function enumerateDates(a,b){ const s=new Date(a), e=new Date(b); s.setHours(0,0,0,0); e.setHours(0,0,0,0); const res=[]; for(let d=new Date(s); d<=e; d.setDate(d.getDate()+1)) res.push(new Date(d)); return res; }
    function pickBestDateInWindow({genre, followers, startDate, endDate, preferred=[{dow:2,hour:18,minute:0},{dow:4,hour:18,minute:0},{dow:5,hour:12,minute:0}]} ){
      const runway=7, today=new Date(), minAllowed=addDays(today,runway);
      const defStart=addDays(today,runway), defEnd=addDays(today,30);
      const wStart=startDate? new Date(startDate): defStart; const wEnd=endDate? new Date(endDate): defEnd;
      const from = wStart<minAllowed ? minAllowed : wStart; const to = wEnd; if(to<from) return { dt: atTime(from,18,0), reason:"–ö–æ—Ä–∏–≥–∏—Ä–∞–Ω –ø–µ—Ä–∏–æ–¥ ‚Üí –ø—ä—Ä–≤–∏ –≤—ä–∑–º–æ–∂–µ–Ω –¥–µ–Ω —Å–ª–µ–¥ runway." };
      const scores=scoreDays(genre, followers); const cand=[]; for(const d of enumerateDates(from,to)){ for(const p of preferred){ if(d.getDay()===p.dow){ cand.push({dt:atTime(d,p.hour,p.minute), score:scores[String(p.dow)]??.5}); } } }
      if(cand.length){ cand.sort((a,b)=>b.score-a.score); return { dt:cand[0].dt, reason:`–ù–∞–π-–≤–∏—Å–æ–∫ —Å–∫–æ—Ä–∏–Ω–≥ –≤ –ø—Ä–æ–∑–æ—Ä–µ—Ü–∞ (${(cand[0].score*100).toFixed(0)}%)` }; }
      return { dt: atTime(from,18,0), reason:"–õ–∏–ø—Å–≤–∞—Ç –ø—Ä–µ–¥–ø–æ—á–∏—Ç–∞–Ω–∏ –¥–Ω–∏ ‚Üí –∏–∑–±—Ä–∞–Ω –µ –ø—ä—Ä–≤–∏—è—Ç –¥–µ–Ω 18:00." };
    }

    // ===== Rich Tips =====
    const tipTeaser = (genre)=>`–í–∏–¥–µ–æ 10‚Äì15 —Å–µ–∫ —Å –Ω–∞–π-—Å–∏–ª–Ω–∏—è hook. –ö–∞–¥—ä—Ä 1: close-up/–ª–∏–ø—Å–∏–Ω–≥; –ö–∞–¥—ä—Ä 2: –±—ä—Ä–∑ cut –∫—ä–º —Ä–µ—Ñ—Ä–µ–Ω–∞.\n–ö–∞–ø—à—ä–Ω: "‚ö° –ü—ä—Ä–≤–∏ –ø–æ–≥–ª–µ–¥ –∫—ä–º [–∏–º–µ] ‚Äî –∞–∫–æ —Ç–∏ —Ö–∞—Ä–µ—Å–∞, –æ—Å—Ç–∞–≤–∏ ‚ù§Ô∏è –∏ –ø–∏—à–∏ –∫–æ—è —Ä–µ–¥–∏—Ü–∞ –¥–∞ –ø—É—Å–Ω–∞ —É—Ç—Ä–µ".\n–•–∞—à—Ç–∞–≥–æ–≤–µ: #[–∂–∞–Ω—Ä] #[mood] + 3 –ø–µ—Ä—Å–æ–Ω–∞–ª–Ω–∏. CTA: "–ó–∞–ø–∞–∑–∏ –∑–≤—É–∫–∞" / "–ü–æ—Å–ª–µ–¥–≤–∞–π –∑–∞ –ø—Ä–µ–º–∏–µ—Ä–∞—Ç–∞".`;
    const tipPresave = ()=>`–ü–æ—Å—Ç + —Å—Ç–æ—Ä–∏—Ç–∞ —Å –ª–∏–Ω–∫ –∑–∞ pre-save (Spotify/Apple). –ü–∏–Ω–Ω–∏ –ø–æ—Å—Ç–∞ 48—á.\n–°—Ç–æ—Ä–∏–∏: Countdown + Question ("–ö–æ—è –µ –ª—é–±–∏–º–∞—Ç–∞ —Ç–∏ —Ä–µ–ø–ª–∏–∫–∞ –æ—Ç —Ç–∏–π–∑—ä—Ä–∞?").\n–ö–∞–ø—à—ä–Ω: "üéØ –ü–æ–º–æ–≥–Ω–∏ –Ω–∞ —Ç—Ä–∞–∫–∞ –¥–∞ –≤–ª–µ–∑–µ –≤ –∞–ª–≥–æ—Ä–∏—Ç—ä–º–∞ ‚Äî pre-save —Å 1 –∫–ª–∏–∫".`;
    const tipBTS = ()=>`BTS –∫–∞—Ä—É—Å–µ–ª/Shorts: 3‚Äì5 –∫–∞–¥—ä—Ä–∞ –æ—Ç –∑–∞–ø–∏—Å/–º–∏–∫—Å/–≤–∏–¥–µ–æ —Å–µ—Ç.\n–°—Ü–µ–Ω–∞—Ä–∏–π: 1) –ø—Ä–æ–±–ª–µ–º ‚Üí 2) —Ä–µ—à–µ–Ω–∏–µ ‚Üí 3) –µ–º–æ—Ü–∏—è.\n–ö–∞–ø—à—ä–Ω: "–ö–∞–∫ –Ω–∞–ø—Ä–∞–≤–∏—Ö–º–µ [hook/—Å–∏–Ω—Ç] ‚Äî swipe –¥–æ –∫—Ä–∞—è –∑–∞ fail –∫–∞–¥—ä—Ä".`;
    const tipCountdown = ()=>`24h –¥–æ –ø—Ä–µ–º–∏–µ—Ä–∞—Ç–∞. –ò–∑–ø–æ–ª–∑–≤–∞–π Reminder –≤ YouTube Premiere/IG Story.\n–ö–∞–ø—à—ä–Ω: "‚è≥ –£—Ç—Ä–µ –≤ [—á–∞—Å]: –ø—Ä–µ–º–∏–µ—Ä–∞ –Ω–∞ [–∏–º–µ] ‚Äî –Ω–∞—Å—Ç—Ä–æ–∏ –Ω–∞–ø–æ–º–Ω—è–Ω–µ –∏ –∫–∞–∂–∏ –æ—Ç –∫—ä–¥–µ —Å–ª—É—à–∞—à".`;
    const tipRelease = ()=>`–õ–∏–Ω–∫–æ–≤–µ + YouTube Premiere. –ó–∞–∫—Ä–µ–ø–∏ 1-–≤–∏ –∫–æ–º–µ–Ω—Ç–∞—Ä: "–ö–æ—è —Å–µ–∫—É–Ω–¥–∞ —Ç–∏ –µ –ª—é–±–∏–º–∞? –û—Å—Ç–∞–≤–∏ —Ç–∞–π–º–∫–æ–¥".\nSmart link –≤ –±–∏–æ; –≤ –æ–ø–∏—Å–∞–Ω–∏–µ—Ç–æ ‚Äî –∫–ª—é—á–æ–≤–∏ –¥—É–º–∏, ISRC, –∫—Ä–µ–¥–∏—Ç–∏, –∫–æ–Ω—Ç–∞–∫—Ç.`;
    const tipLive = ()=>`TikTok/IG Live 20‚Äì30 –º–∏–Ω: 1) –ò—Å—Ç–æ—Ä–∏—è ‚Üí 2) –ø—ä—Ä–≤–æ —Å–ª—É—à–∞–Ω–µ (hook) ‚Üí 3) Q&A ‚Üí 4) –∞–∫—É—Å—Ç–∏—á–µ–Ω –æ—Ç–∫—ä—Å.\nCTA: "–ó–∞–ø–∞–∑–∏ –≤ –ø–ª–µ–π–ª–∏—Å—Ç" / "–ü—Ä–∞—Ç–∏ –Ω–∞ –ø—Ä–∏—è—Ç–µ–ª".`;
    const tipPerf = ()=>`Reels/TikTok 20‚Äì30 —Å–µ–∫ (hook). –î–æ–±–∞–≤–∏ captions –∏ —Ç–µ–∫—Å—Ç –≤—ä—Ä—Ö—É –≤–∏–¥–µ–æ —Å –∫–ª—é—á–æ–≤–∞ —Ñ—Ä–∞–∑–∞.\n–ö–∞–ø—à—ä–Ω: "–∞–∫–æ —Ç–æ–≤–∞ –≤–ª–µ–∑–µ –≤ –≥–ª–∞–≤–∞—Ç–∞ —Ç–∏ ‚Äî –∑–∞–ø–∞–∑–∏ —Ç—Ä–∞–∫–∞". –°—Ç–∞—Ä—Ç–∏—Ä–∞–π #[–∏–º–µ]Challenge.`;
    const tipCollab = ()=>`–ö–æ–ª–∞–±–æ—Ä–∞—Ü–∏—è —Å –º–∏–∫—Ä–æ–∏–Ω—Ñ–ª—É–µ–Ω—Å—ä—Ä (5‚Äì50k). –î–∞–π 3 –∏–¥–µ–∏ –∑–∞ –¥—É–µ—Ç (—Ç–∞–Ω—Ü, —Ä–µ–∞–∫—Ü–∏—è, —Ö–∞—Ä–º–æ–Ω–∏—è).\n–®–∞–±–ª–æ–Ω –∑–∞ DM: "–ó–¥—Ä–∞—Å—Ç–∏ [–∏–º–µ]! –ò–º–∞–º –Ω–æ–≤ —Ç—Ä–∞–∫ [–∂–∞–Ω—Ä], hook –Ω–∞ 0:12. –©–µ —Ç–∏ –ø—Ä–∞—Ç—è clean snippet –∑–∞ –¥—É–µ—Ç. –ò—Å–∫–∞—à –ª–∏ early access?"`;
    const tipDJ = ()=>`DJ promo pack: Radio Edit + Club Edit + Instrumental + Cover 3000x3000 + One-sheet PDF.\n–ò–º–µ–π–ª —Ç–µ–º–∞: "PROMO: [Artist ‚Äì Track] (320kbps) ‚Äî early support". –õ–∏–Ω–∫ –∫—ä–º Dropbox/Drive.`;

    function makePlan(releaseDate, genre){
      const events=[], rd=releaseDate, g=(genre||"").toLowerCase();
      const minus=(d,h=10)=>{const x=addDays(rd,-d); x.setHours(h,0,0,0); return x;};
      const plus =(d,h=11)=>{const x=addDays(rd, d); x.setHours(h,0,0,0); return x;};
      events.push({when:minus(7,19), title:"Teaser –≤–∏–¥–µ–æ (15 —Å–µ–∫)", channel:"TikTok/IG Reels", tip:tipTeaser(g)});
      events.push({when:minus(5,12), title:"Pre-save –∫–∞–º–ø–∞–Ω–∏—è", channel:"Link in bio", tip:tipPresave()});
      events.push({when:minus(3,19), title:"Behind-the-scenes", channel:"Stories + YouTube Shorts", tip:tipBTS()});
      events.push({when:minus(1,18), title:"–ö–∞—É—ä–Ω—Ç–¥–∞—É–Ω –ø–æ—Å—Ç", channel:"IG/TikTok", tip:tipCountdown()});
      events.push({when:rd,         title:"RELEASE", channel:"Spotify/YouTube", tip:tipRelease()});
      events.push({when:plus(1,12),  title:"Live Q&A", channel:"TikTok Live", tip:tipLive()});
      events.push({when:plus(3,18),  title:"Performance clip", channel:"IG Reels", tip:tipPerf()});
      events.push({when:plus(7,18),  title:"Collab –ø–æ—Å—Ç", channel:"–ú–∏–∫—Ä–æ–∏–Ω—Ñ–ª—É–µ–Ω—Å—ä—Ä", tip:tipCollab()});
      if(["edm","trap"].includes(g)) events.push({when:plus(10,20), title:"DJ promo pack", channel:"Dropbox/Promo mail", tip:tipDJ()});
      return events.sort((a,b)=>a.when-b.when);
    }

    function toCSV(events){
      const header=["–î–∞—Ç–∞","–î–µ–π–Ω–æ—Å—Ç","–ö–∞–Ω–∞–ª","–°—ä–≤–µ—Ç"].join(",");
      const rows=events.map(e=>[e.when.toISOString(),e.title,e.channel,e.tip].map(x=>`"${String(x).replaceAll('"','\\"')}"`).join(","));
      return [header,...rows].join("\n");
    }
    function icsForEvents(events, projectName="Smart Release Planner"){
      const dtStamp=new Date();
      const fmt=(d)=>`${d.getUTCFullYear()}${String(d.getUTCMonth()+1).padStart(2,"0")}${String(d.getUTCDate()).padStart(2,"0")}T${String(d.getUTCHours()).padStart(2,"0")}${String(d.getUTCMinutes()).padStart(2,"0")}${String(d.getUTCSeconds()).padStart(2,"0")}Z`;
      const lines=["BEGIN:VCALENDAR","VERSION:2.0","PRODID:-//Smart Release Planner//BG"];
      events.forEach((e,i)=>{const start=new Date(e.when), end=new Date(start.getTime()+60*60*1000); lines.push("BEGIN:VEVENT",`UID:${i}-${dtStamp.getTime()}@smart-release`, `DTSTAMP:${fmt(dtStamp)}`, `DTSTART:${fmt(start)}`, `DTEND:${fmt(end)}`, `SUMMARY:${e.title} ‚Äî ${projectName}`, `DESCRIPTION:${e.channel} | ${e.tip}`, "END:VEVENT");});
      lines.push("END:VCALENDAR");
      return lines.join("\r\n");
    }
    function download(filename, text){ const blob=new Blob([text],{type:"text/plain;charset=utf-8"}); const url=URL.createObjectURL(blob); const a=document.createElement("a"); a.href=url; a.download=filename; a.click(); setTimeout(()=>URL.revokeObjectURL(url),800); }

    // ===== PDF (print-friendly) =====
    function buildPrintableHTML(meta, events){
      const esc=(s)=>String(s).replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;");
      const rows=events.map(e=>`<tr><td>${esc(new Date(e.when).toLocaleString('bg-BG'))}</td><td>${esc(e.title)}</td><td>${esc(e.channel)}</td><td>${esc(e.tip)}</td></tr>`).join("");
      return `<!doctype html><html><head><meta charset='utf-8'><title>Release Plan PDF</title>
      <style>body{font:14px/1.45 system-ui,Segoe UI,Roboto,sans-serif;color:#111;margin:32px;} h1{margin:0 0 6px;} .muted{color:#555} table{width:100%;border-collapse:collapse;margin-top:16px} th,td{border:1px solid #ddd;padding:8px;vertical-align:top} th{background:#f3f4f6;text-align:left} .head{margin-top:12px} .small{font-size:12px;color:#444}</style>
      </head><body>
      <h1>Smart Release Planner ‚Äî –ü–ª–∞–Ω</h1>
      <div class='muted'>–ñ–∞–Ω—Ä: ${esc(meta.genre||'-')} ¬∑ –ü–µ—Ä–∏–æ–¥: ${esc(meta.winStart)} ‚Üí ${esc(meta.winEnd)}</div>
      <div class='head'><b>–ü—Ä–µ–ø–æ—Ä—ä—á–∞–Ω–∞ –¥–∞—Ç–∞:</b> ${esc(meta.recDate)}<br><span class='small'>–ü—Ä–∏—á–∏–Ω–∞: ${esc(meta.reason)}</span></div>
      <table><thead><tr><th>–î–∞—Ç–∞/–ß–∞—Å</th><th>–î–µ–π–Ω–æ—Å—Ç</th><th>–ö–∞–Ω–∞–ª</th><th>–ò–¥–µ–∏/–°—ä–≤–µ—Ç–∏</th></tr></thead><tbody>${rows}</tbody></table>
      <script>window.onload=()=>{window.print();setTimeout(()=>window.close(),300);};</script>
      </body></html>`;
    }

    // ===== App wiring =====
    const $=(id)=>document.getElementById(id);
    const resultWrap=$("resultWrap"), recDate=$("recDate"), reason=$("reason"), windowInfo=$("windowInfo"), bestDays=$("bestDays"), eventsGrid=$("eventsGrid");

    function setDefaults(){ const s=addDays(new Date(),7).toISOString().slice(0,10); const e=addDays(new Date(),30).toISOString().slice(0,10); $("wstart").value=s; $("wend").value=e; }

    let lastPlan=null, lastMeta=null;

    $("genBtn").addEventListener("click",()=>{
      if(!$("songFile").files.length){ alert("–ú–æ–ª—è, –∫–∞—á–∏ –ø–µ—Å–µ–Ω!"); return; }
      const genre=$("genre").value.trim(); const followers=$("followers").value.trim(); const winStart=$("wstart").value; const winEnd=$("wend").value;
      const {dt, reason:why}=pickBestDateInWindow({genre, followers, startDate:winStart, endDate:winEnd});
      const plan=makePlan(dt, genre);
      recDate.textContent=fmtBG(dt); reason.textContent=`–ü—Ä–∏—á–∏–Ω–∞: ${why}`; windowInfo.textContent=`–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –Ω–∞ –ø–µ—Ä–∏–æ–¥: ${winStart} ‚Üí ${winEnd} (‚â• 7 –¥–Ω–∏ runway)`;
      bestDays.innerHTML=""; ["–≤—Ç–æ—Ä–Ω–∏–∫","—á–µ—Ç–≤—ä—Ä—Ç—ä–∫"].forEach(d=>{ const li=document.createElement("li"); li.textContent=d; bestDays.appendChild(li); });
      eventsGrid.innerHTML=""; plan.forEach(ev=>{ const div=document.createElement("div"); div.className="event"; div.innerHTML=`<div class='muted'>${fmtBG(ev.when)}</div><div class='title' style='margin-top:6px'>${ev.title}</div><div class='muted' style='margin-top:4px'><b>–ö–∞–Ω–∞–ª:</b> ${ev.channel}</div><div class='tips'><b>–ò–¥–µ–∏:</b> ${ev.tip}</div>`; eventsGrid.appendChild(div); });
      $("csvBtn").onclick=()=>download("release_plan.csv", toCSV(plan));
      $("icsBtn").onclick=()=>download("release_plan.ics", icsForEvents(plan, "Smart Release Planner"));
      $("pdfBtn").onclick=()=>{ const meta={genre, winStart, winEnd, recDate:recDate.textContent, reason:why}; const html=buildPrintableHTML(meta, plan); const w=window.open("about:blank","_blank"); w.document.open(); w.document.write(html); w.document.close(); };
      lastPlan=plan; lastMeta={genre, winStart, winEnd, recDate:recDate.textContent, reason:why};
      resultWrap.classList.remove("hidden");
    });

    setDefaults();
  </script>
</body>
</html>
